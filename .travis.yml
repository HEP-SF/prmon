sudo: required

# Add only master and stable branches
branches:
  only:
    - master
    - stable

# Notify on failure
notifications:
  email: on_failure

# Test across multiple containers
env:
  - DIMAGE=hepsoftwarefoundation/c7-dev 
  - DIMAGE=hepsoftwarefoundation/c7-dev CMAKE_EXTRA=-DPYTHON_TEST=python2
  - DIMAGE=hepsoftwarefoundation/u18-dev 
  - DIMAGE=hepsoftwarefoundation/c8-dev
  - DIMAGE=hepsoftwarefoundation/u20-dev

services:
  - docker

before_install:
  - docker pull $DIMAGE

install:
  - /bin/true

# Light customisation of build for different container images
script:
  - if [ "$DIMAGE" = hepsoftwarefoundation/c7-dev ];  then docker run -e CMAKE=cmake3 -e CMAKE_EXTRA=$CMAKE_EXTRA -v $(pwd):/mnt $DIMAGE scl enable devtoolset-8 /mnt/.travis-scripts/build-test.sh; fi
  - if [ "$DIMAGE" = hepsoftwarefoundation/u18-dev ]; then docker run -e CMAKE_EXTRA=-Dnlohmann_json_DIR=/usr/lib/cmake -v $(pwd):/mnt $DIMAGE /mnt/.travis-scripts/build-test.sh; fi
  - if [ "$DIMAGE" = hepsoftwarefoundation/c8-dev ];  then docker run -v $(pwd):/mnt $DIMAGE /mnt/.travis-scripts/build-test.sh; fi
  - if [ "$DIMAGE" = hepsoftwarefoundation/u20-dev ]; then docker run -e CXX=g++-9 -e CC=gcc-9 -v $(pwd):/mnt $DIMAGE /mnt/.travis-scripts/build-test.sh; fi
